"use strict";(self.webpackChunkpixtarAE=self.webpackChunkpixtarAE||[]).push([[492],{7666:(qn,_t,rt)=>{rt.r(_t),rt.d(_t,{CompressedGaussianSplats:()=>et,GSplineBuffer:()=>bt,GaussianPLYData:()=>W});var st=rt(5861),Yt=Object.create,nt=Object.defineProperty,Qt=Object.getOwnPropertyDescriptor,Xt=Object.getOwnPropertyNames,Kt=Object.getPrototypeOf,Jt=Object.prototype.hasOwnProperty,G=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports),ht=(t,a)=>{for(var s in a)nt(t,s,{get:a[s],enumerable:!0})},T=(t,a,s)=>(s=null!=t?Yt(Kt(t)):{},((t,a,s,i)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let n of Xt(a))!Jt.call(t,n)&&undefined!==n&&nt(t,n,{get:()=>a[n],enumerable:!(i=Qt(a,n))||i.enumerable});return t})(!a&&t&&t.__esModule?s:nt(s,"default",{value:t,enumerable:!0}),t)),P=(t,a,s)=>(((t,a,s)=>{a in t?nt(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s})(t,"symbol"!=typeof a?a+"":a,s),s),sa=G((t,a)=>{a.exports=function s(i){for(var n=new Array(i),e=0;e<i;++e)n[e]=e;return n}}),na=G((t,a)=>{function s(n){return!!n.constructor&&"function"==typeof n.constructor.isBuffer&&n.constructor.isBuffer(n)}a.exports=function(n){return null!=n&&(s(n)||function i(n){return"function"==typeof n.readFloatLE&&"function"==typeof n.slice&&s(n.slice(0,0))}(n)||!!n._isBuffer)}}),J=G((t,a)=>{var s=sa(),i=na(),n=typeof Float64Array<"u";function e(p,l){return p[0]-l[0]}function o(){var c,p=this.stride,l=new Array(p.length);for(c=0;c<l.length;++c)l[c]=[Math.abs(p[c]),c];l.sort(e);var d=new Array(l.length);for(c=0;c<d.length;++c)d[c]=l[c][1];return d}function r(p,l){var c=["View",l,"d",p].join("");l<0&&(c="View_Nil"+p);var d="generic"===p;if(-1===l){var g="function "+c+"(a){this.data=a;};var proto="+c+".prototype;proto.dtype='"+p+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+c+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+c+"(a){return new "+c+"(a);}";return new Function(g)()}if(0===l)return g="function "+c+"(a,d) {this.data = a;this.offset = d};var proto="+c+".prototype;proto.dtype='"+p+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+c+"_copy() {return new "+c+"(this.data,this.offset)};proto.pick=function "+c+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+c+"_get(){return "+(d?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+c+"_set(v){return "+(d?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+c+"(a,b,c,d){return new "+c+"(a,d)}",new Function("TrivialArray",g)(u[p][0]);g=["'use strict'"];var y=s(l),m=y.map(function(k){return"i"+k}),_="this.offset+"+y.map(function(k){return"this.stride["+k+"]*i"+k}).join("+"),b=y.map(function(k){return"b"+k}).join(","),M=y.map(function(k){return"c"+k}).join(",");g.push("function "+c+"(a,"+b+","+M+",d){this.data=a","this.shape=["+b+"]","this.stride=["+M+"]","this.offset=d|0}","var proto="+c+".prototype","proto.dtype='"+p+"'","proto.dimension="+l),g.push("Object.defineProperty(proto,'size',{get:function "+c+"_size(){return "+y.map(function(k){return"this.shape["+k+"]"}).join("*"),"}})"),1===l?g.push("proto.order=[0]"):(g.push("Object.defineProperty(proto,'order',{get:"),l<4?(g.push("function "+c+"_order(){"),2===l?g.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===l&&g.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):g.push("ORDER})")),g.push("proto.set=function "+c+"_set("+m.join(",")+",v){"),g.push(d?"return this.data.set("+_+",v)}":"return this.data["+_+"]=v}"),g.push("proto.get=function "+c+"_get("+m.join(",")+"){"),g.push(d?"return this.data.get("+_+")}":"return this.data["+_+"]}"),g.push("proto.index=function "+c+"_index(",m.join(),"){return "+_+"}"),g.push("proto.hi=function "+c+"_hi("+m.join(",")+"){return new "+c+"(this.data,"+y.map(function(k){return["(typeof i",k,"!=='number'||i",k,"<0)?this.shape[",k,"]:i",k,"|0"].join("")}).join(",")+","+y.map(function(k){return"this.stride["+k+"]"}).join(",")+",this.offset)}");var x=y.map(function(k){return"a"+k+"=this.shape["+k+"]"}),w=y.map(function(k){return"c"+k+"=this.stride["+k+"]"});g.push("proto.lo=function "+c+"_lo("+m.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+w.join(","));for(var v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");for(g.push("return new "+c+"(this.data,"+y.map(function(k){return"a"+k}).join(",")+","+y.map(function(k){return"c"+k}).join(",")+",b)}"),g.push("proto.step=function "+c+"_step("+m.join(",")+"){var "+y.map(function(k){return"a"+k+"=this.shape["+k+"]"}).join(",")+","+y.map(function(k){return"b"+k+"=this.stride["+k+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");g.push("return new "+c+"(this.data,"+y.map(function(k){return"a"+k}).join(",")+","+y.map(function(k){return"b"+k}).join(",")+",c)}");var A=new Array(l),S=new Array(l);for(v=0;v<l;++v)A[v]="a[i"+v+"]",S[v]="b[i"+v+"]";for(g.push("proto.transpose=function "+c+"_transpose("+m+"){"+m.map(function(k,F){return k+"=("+k+"===undefined?"+F+":"+k+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+c+"(this.data,"+A.join(",")+","+S.join(",")+",this.offset)}"),g.push("proto.pick=function "+c+"_pick("+m+"){var a=[],b=[],c=this.offset"),v=0;v<l;++v)g.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return g.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),g.push("return function construct_"+c+"(data,shape,stride,offset){return new "+c+"(data,"+y.map(function(k){return"shape["+k+"]"}).join(",")+","+y.map(function(k){return"stride["+k+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",g.join("\n"))(u[p],o)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};a.exports=function f(p,l,c,d){if(void 0===p)return(0,u.array[0])([]);"number"==typeof p&&(p=[p]),void 0===l&&(l=[p.length]);var g=l.length;if(void 0===c){c=new Array(g);for(var y=g-1,m=1;y>=0;--y)c[y]=m,m*=l[y]}if(void 0===d)for(d=0,y=0;y<g;++y)c[y]<0&&(d-=(l[y]-1)*c[y]);for(var _=function h(p){if(i(p))return"buffer";if(n)switch(Object.prototype.toString.call(p)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(p)?"array":"generic"}(p),b=u[_];b.length<=g+1;)b.push(r(_,b.length-1));return(0,b[g+1])(p,l,c,d)}}),ia=G((t,a)=>{a.exports=function n(e,o,r){return 0===e.length?e:o?(r||e.sort(o),function s(e,o){for(var r=1,h=e.length,u=e[0],f=e[0],p=1;p<h;++p)if(f=u,o(u=e[p],f)){if(p===r){r++;continue}e[r++]=u}return e.length=r,e}(e,o)):(r||e.sort(),function i(e){for(var o=1,r=e.length,h=e[0],u=e[0],f=1;f<r;++f,u=h)if(u=h,(h=e[f])!==u){if(f===o){o++;continue}e[o++]=h}return e.length=o,e}(e))}}),ea=G((t,a)=>{var s=ia();function i(u,f,p){var b,M,l=u.length,c=f.arrayArgs.length,d=f.indexArgs.length>0,g=[],y=[],m=0,_=0;for(b=0;b<l;++b)y.push(["i",b,"=0"].join(""));for(M=0;M<c;++M)for(b=0;b<l;++b)_=m,m=u[b],y.push(0===b?["d",M,"s",b,"=t",M,"p",m].join(""):["d",M,"s",b,"=(t",M,"p",m,"-s",_,"*t",M,"p",_,")"].join(""));for(y.length>0&&g.push("var "+y.join(",")),b=l-1;b>=0;--b)g.push(["for(i",b,"=0;i",b,"<s",m=u[b],";++i",b,"){"].join(""));for(g.push(p),b=0;b<l;++b){for(_=m,m=u[b],M=0;M<c;++M)g.push(["p",M,"+=d",M,"s",b].join(""));d&&(b>0&&g.push(["index[",_,"]-=s",_].join("")),g.push(["++index[",m,"]"].join(""))),g.push("}")}return g.join("\n")}function o(u,f,p){for(var l=u.body,c=[],d=[],g=0;g<u.args.length;++g){var y=u.args[g];if(!(y.count<=0)){var m=new RegExp(y.name,"g"),_="",b=f.arrayArgs.indexOf(g);switch(f.argTypes[g]){case"offset":var M=f.offsetArgIndex.indexOf(g);b=f.offsetArgs[M].array,_="+q"+M;case"array":_="p"+b+_;var w="l"+g,v="a"+b;if(0===f.arrayBlockIndices[b])1===y.count?"generic"===p[b]?y.lvalue?(c.push(["var ",w,"=",v,".get(",_,")"].join("")),l=l.replace(m,w),d.push([v,".set(",_,",",w,")"].join(""))):l=l.replace(m,[v,".get(",_,")"].join("")):l=l.replace(m,[v,"[",_,"]"].join("")):"generic"===p[b]?(c.push(["var ",w,"=",v,".get(",_,")"].join("")),l=l.replace(m,w),y.lvalue&&d.push([v,".set(",_,",",w,")"].join(""))):(c.push(["var ",w,"=",v,"[",_,"]"].join("")),l=l.replace(m,w),y.lvalue&&d.push([v,"[",_,"]=",w].join("")));else{for(var A=[y.name],S=[_],z=0;z<Math.abs(f.arrayBlockIndices[b]);z++)A.push("\\s*\\[([^\\]]+)\\]"),S.push("$"+(z+1)+"*t"+b+"b"+z);if(m=new RegExp(A.join(""),"g"),_=S.join("+"),"generic"===p[b])throw new Error("cwise: Generic arrays not supported in combination with blocks!");l=l.replace(m,[v,"[",_,"]"].join(""))}break;case"scalar":l=l.replace(m,"Y"+f.scalarArgs.indexOf(g));break;case"index":l=l.replace(m,"index");break;case"shape":l=l.replace(m,"shape")}}}return[c.join("\n"),l,d.join("\n")].join("\n").trim()}function r(u){for(var f=new Array(u.length),p=!0,l=0;l<u.length;++l){var c=u[l],d=c.match(/\d+/);d=d?d[0]:"",f[l]=0===c.charAt(0)?"u"+c.charAt(1)+d:c.charAt(0)+d,l>0&&(p=p&&f[l]===f[l-1])}return p?f[0]:f.join("")}a.exports=function h(u,f){for(var p=f[1].length-Math.abs(u.arrayBlockIndices[0])|0,l=new Array(u.arrayArgs.length),c=new Array(u.arrayArgs.length),d=0;d<u.arrayArgs.length;++d)c[d]=f[2*d],l[d]=f[2*d+1];var g=[],y=[],m=[],_=[],b=[];for(d=0;d<u.arrayArgs.length;++d){u.arrayBlockIndices[d]<0?(m.push(0),_.push(p),g.push(p),y.push(p+u.arrayBlockIndices[d])):(m.push(u.arrayBlockIndices[d]),_.push(u.arrayBlockIndices[d]+p),g.push(0),y.push(u.arrayBlockIndices[d]));for(var M=[],x=0;x<l[d].length;x++)m[d]<=l[d][x]&&l[d][x]<_[d]&&M.push(l[d][x]-m[d]);b.push(M)}var w=["SS"],v=["'use strict'"],A=[];for(x=0;x<p;++x)A.push(["s",x,"=SS[",x,"]"].join(""));for(d=0;d<u.arrayArgs.length;++d){for(w.push("a"+d),w.push("t"+d),w.push("p"+d),x=0;x<p;++x)A.push(["t",d,"p",x,"=t",d,"[",m[d]+x,"]"].join(""));for(x=0;x<Math.abs(u.arrayBlockIndices[d]);++x)A.push(["t",d,"b",x,"=t",d,"[",g[d]+x,"]"].join(""))}for(d=0;d<u.scalarArgs.length;++d)w.push("Y"+d);if(u.shapeArgs.length>0&&A.push("shape=SS.slice(0)"),u.indexArgs.length>0){var S=new Array(p);for(d=0;d<p;++d)S[d]="0";A.push(["index=[",S.join(","),"]"].join(""))}for(d=0;d<u.offsetArgs.length;++d){var z=u.offsetArgs[d],k=[];for(x=0;x<z.offset.length;++x)0!==z.offset[x]&&k.push(1===z.offset[x]?["t",z.array,"p",x].join(""):[z.offset[x],"*t",z.array,"p",x].join(""));A.push(0===k.length?"q"+d+"=0":["q",d,"=",k.join("+")].join(""))}var F=s([].concat(u.pre.thisVars).concat(u.body.thisVars).concat(u.post.thisVars));for((A=A.concat(F)).length>0&&v.push("var "+A.join(",")),d=0;d<u.arrayArgs.length;++d)v.push("p"+d+"|=0");u.pre.body.length>3&&v.push(o(u.pre,u,c));var N=o(u.body,u,c),q=function e(u){for(var f=0,p=u[0].length;f<p;){for(var l=1;l<u.length;++l)if(u[l][f]!==u[0][f])return f;++f}return f}(b);v.push(q<p?function n(u,f,p,l){for(var c=f.length,d=p.arrayArgs.length,g=p.blockSize,y=p.indexArgs.length>0,m=[],_=0;_<d;++_)m.push(["var offset",_,"=p",_].join(""));for(_=u;_<c;++_)m.push(["for(var j"+_+"=SS[",f[_],"]|0;j",_,">0;){"].join("")),m.push(["if(j",_,"<",g,"){"].join("")),m.push(["s",f[_],"=j",_].join("")),m.push(["j",_,"=0"].join("")),m.push(["}else{s",f[_],"=",g].join("")),m.push(["j",_,"-=",g,"}"].join("")),y&&m.push(["index[",f[_],"]=j",_].join(""));for(_=0;_<d;++_){for(var b=["offset"+_],M=u;M<c;++M)b.push(["j",M,"*t",_,"p",f[M]].join(""));m.push(["p",_,"=(",b.join("+"),")"].join(""))}for(m.push(i(f,p,l)),_=u;_<c;++_)m.push("}");return m.join("\n")}(q,b[0],u,N):i(b[0],u,N)),u.post.body.length>3&&v.push(o(u.post,u,c)),u.debug&&console.log("-----Generated cwise routine for ",f,":\n"+v.join("\n")+"\n----------");var I=[u.funcName||"unnamed","_cwise_loop_",l[0].join("s"),"m",q,r(c)].join("");return new Function(["function ",I,"(",w.join(","),"){",v.join("\n"),"} return ",I].join(""))()}}),oa=G((t,a)=>{var s=ea();a.exports=function i(n){var e=["'use strict'","var CACHED={}"],o=[];e.push(["return function ",n.funcName+"_cwise_thunk","(",n.shimArgs.join(","),"){"].join(""));for(var h=[],u=[],f=[["array",n.arrayArgs[0],".shape.slice(",Math.max(0,n.arrayBlockIndices[0]),n.arrayBlockIndices[0]<0?","+n.arrayBlockIndices[0]+")":")"].join("")],p=[],l=[],c=0;c<n.arrayArgs.length;++c){var d=n.arrayArgs[c];o.push(["t",d,"=array",d,".dtype,","r",d,"=array",d,".order"].join("")),h.push("t"+d),h.push("r"+d),u.push("t"+d),u.push("r"+d+".join()"),f.push("array"+d+".data"),f.push("array"+d+".stride"),f.push("array"+d+".offset|0"),c>0&&(p.push("array"+n.arrayArgs[0]+".shape.length===array"+d+".shape.length+"+(Math.abs(n.arrayBlockIndices[0])-Math.abs(n.arrayBlockIndices[c]))),l.push("array"+n.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,n.arrayBlockIndices[0])+"]===array"+d+".shape[shapeIndex+"+Math.max(0,n.arrayBlockIndices[c])+"]"))}for(n.arrayArgs.length>1&&(e.push("if (!("+p.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+n.arrayArgs[0]+".shape.length-"+Math.abs(n.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),e.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}")),c=0;c<n.scalarArgs.length;++c)f.push("scalar"+n.scalarArgs[c]);return o.push(["type=[",u.join(","),"].join()"].join("")),o.push("proc=CACHED[type]"),e.push("var "+o.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",h.join(","),"])}","return proc(",f.join(","),")}"].join("")),n.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------"),new Function("compile",e.join("\n"))(s.bind(void 0,n))}}),ra=G((t,a)=>{var s=oa();function i(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}a.exports=function n(e){var o=new i;o.pre=e.pre,o.body=e.body,o.post=e.post;var r=e.args.slice(0);o.argTypes=r;for(var h=0;h<r.length;++h){var u=r[h];if("array"===u||"object"==typeof u&&u.blockIndices){if(o.argTypes[h]="array",o.arrayArgs.push(h),o.arrayBlockIndices.push(u.blockIndices?u.blockIndices:0),o.shimArgs.push("array"+h),h<o.pre.args.length&&o.pre.args[h].count>0)throw new Error("cwise: pre() block may not reference array args");if(h<o.post.args.length&&o.post.args[h].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===u)o.scalarArgs.push(h),o.shimArgs.push("scalar"+h);else if("index"===u){if(o.indexArgs.push(h),h<o.pre.args.length&&o.pre.args[h].count>0)throw new Error("cwise: pre() block may not reference array index");if(h<o.body.args.length&&o.body.args[h].lvalue)throw new Error("cwise: body() block may not write to array index");if(h<o.post.args.length&&o.post.args[h].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===u){if(o.shapeArgs.push(h),h<o.pre.args.length&&o.pre.args[h].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(h<o.body.args.length&&o.body.args[h].lvalue)throw new Error("cwise: body() block may not write to array shape");if(h<o.post.args.length&&o.post.args[h].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof u||!u.offset)throw new Error("cwise: Unknown argument type "+r[h]);o.argTypes[h]="offset",o.offsetArgs.push({array:u.array,offset:u.offset}),o.offsetArgIndex.push(h)}}if(o.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(o.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(o.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(o.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return o.debug=!!e.printCode||!!e.debug,o.funcName=e.funcName||"cwise",o.blockSize=e.blockSize||64,s(o)}}),tt=G(t=>{var a=ra(),s={body:"",args:[],thisVars:[],localVars:[]};function i(l){if(!l)return s;for(var c=0;c<l.args.length;++c){var d=l.args[c];l.args[c]=0===c?{name:d,lvalue:!0,rvalue:!!l.rvalue,count:l.count||1}:{name:d,lvalue:!1,rvalue:!0,count:1}}return l.thisVars||(l.thisVars=[]),l.localVars||(l.localVars=[]),l}function e(l){for(var c=[],d=0;d<l.args.length;++d)c.push("a"+d);return new Function("P",["return function ",l.funcName,"_ndarrayops(",c.join(","),") {P(",c.join(","),");return a0}"].join(""))(function n(l){return a({args:l.args,pre:i(l.pre),body:i(l.body),post:i(l.proc),funcName:l.funcName})}(l))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var l in o){var c=o[l];t[l]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:l}),t[l+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a"+c+"=b"},rvalue:!0,funcName:l+"eq"}),t[l+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:l+"s"}),t[l+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a"+c+"=s"},rvalue:!0,funcName:l+"seq"})}}();var r={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var l in r){var c=r[l];t[l]=e({args:["array","array"],body:{args:["a","b"],body:"a="+c+"b"},funcName:l}),t[l+"eq"]=e({args:["array"],body:{args:["a"],body:"a="+c+"a"},rvalue:!0,count:2,funcName:l+"eq"})}}();var h={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var l in h){var c=h[l];t[l]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:l}),t[l+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:l+"s"}),t[l+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a=a"+c+"b"},rvalue:!0,count:2,funcName:l+"eq"}),t[l+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+c+"s"},rvalue:!0,count:2,funcName:l+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var l=0;l<u.length;++l){var c=u[l];t[c]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:c}),t[c+"eq"]=e({args:["array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"})}}();var f=["max","min","atan2","pow"];!function(){for(var l=0;l<f.length;++l){var c=f[l];t[c]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c}),t[c+"s"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c+"s"}),t[c+"eq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"}),t[c+"seq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"seq"})}}();var p=["atan2","pow"];(function(){for(var l=0;l<p.length;++l){var c=p[l];t[c+"op"]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"op"}),t[c+"ops"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"ops"}),t[c+"opeq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opeq"}),t[c+"opseq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opseq"})}})(),t.any=a({args:["array"],pre:s,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=a({args:["array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=a({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=a({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=a({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=a({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=e({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=e({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=e({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=a({args:["array","array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),$=T(J(),1),R=T(tt(),1),U=T(J(),1),j=T(tt(),1),it=class{constructor(t,a,s){this._dataNormalized=t,this._minD=a,this._maxD=s}static createFromUnnormalized(t){let a=j.sup(t),s=j.inf(t),i=(0,U.default)(new Float32Array(t.size),t.shape),n=a-s;return n<1e-4?j.assigns(i,0):(j.subs(i,t,s),j.divs(i,i,n)),new it(i,s,a)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let t=(0,U.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return j.muls(t,this._dataNormalized,this._maxD-this._minD),j.adds(t,t,this._minD),t}},B=class{constructor(t,a){this._quantized=t,this._method=a}get quantized(){return this._quantized}static maxIntBits(t){return 2**t-1}static fromNormalized(t,a){let i,s=t.data;if("norm8x"===a){let n=B.maxIntBits(8),e=(0,U.default)(new Float32Array(s.size),s.shape);j.muls(e,s,n),j.roundeq(e),i=(0,U.default)(new Uint8Array(e.data),s.shape)}else if("norm565"===a){let n=(0,U.default)(new Float32Array(s.size),s.shape);j.assign(n,s),j.mulseq(n.pick(null,0),B.maxIntBits(5)),j.mulseq(n.pick(null,1),B.maxIntBits(6)),j.mulseq(n.pick(null,2),B.maxIntBits(5)),j.roundeq(n);let e=(0,U.default)(new Uint16Array(n.data),s.shape),o=(0,U.default)(new Uint16Array(s.shape[0]),[s.shape[0]]),r=(0,U.default)(new Uint16Array(s.shape[0]),[s.shape[0]]);j.lshifts(o,e.pick(null,0),11),j.lshifts(r,e.pick(null,1),5),j.boreq(o,r),j.boreq(o,e.pick(null,2)),i=o}else{let n=(0,U.default)(new Float32Array(s.size),s.shape);j.assign(n,s),j.mulseq(n.pick(null,0),B.maxIntBits(11)),j.mulseq(n.pick(null,1),B.maxIntBits(10)),j.mulseq(n.pick(null,2),B.maxIntBits(11)),j.roundeq(n);let e=(0,U.default)(new Uint32Array(n.data),s.shape),o=(0,U.default)(new Uint32Array(s.shape[0]),[s.shape[0]]),r=(0,U.default)(new Uint32Array(s.shape[0]),[s.shape[0]]);j.lshifts(o,e.pick(null,0),21),j.lshifts(r,e.pick(null,1),11),j.boreq(o,r),j.boreq(o,e.pick(null,2)),i=o}return new B(i,a)}dequantize(t,a){let i,s=this._method,n=this._quantized;if("norm8x"===s){let e=B.maxIntBits(8);i=(0,U.default)(new Float32Array(n.size),n.shape),j.muls(i,n,1/e)}else if("norm565"===s){let e=(0,U.default)(new Uint8Array(n.shape[0]),[n.shape[0]]),o=(0,U.default)(new Uint8Array(n.shape[0]),[n.shape[0]]),r=(0,U.default)(new Uint8Array(n.shape[0]),[n.shape[0]]);j.rrshifts(e,n,11),j.rrshifts(o,n,5),j.bandseq(o,B.maxIntBits(6)),j.bands(r,n,B.maxIntBits(5)),i=(0,U.default)(new Float32Array(3*n.shape[0]),[n.shape[0],3]),j.muls(i.pick(null,0),e,1/B.maxIntBits(5)),j.muls(i.pick(null,1),o,1/B.maxIntBits(6)),j.muls(i.pick(null,2),r,1/B.maxIntBits(5))}else{let e=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),o=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]),r=(0,U.default)(new Uint16Array(n.shape[0]),[n.shape[0]]);j.rrshifts(e,n,21),j.rrshifts(o,n,11),j.bandseq(o,B.maxIntBits(10)),j.bands(r,n,B.maxIntBits(11)),i=(0,U.default)(new Float32Array(3*n.shape[0]),[n.shape[0],3]),j.muls(i.pick(null,0),e,1/B.maxIntBits(11)),j.muls(i.pick(null,1),o,1/B.maxIntBits(10)),j.muls(i.pick(null,2),r,1/B.maxIntBits(11))}return new it(i,t,a)}},L=class{constructor(t,a,s,i,n,e=!1){this._quantized=t,this._minMaxMatrix=a,this._chunkSize=s,this._quantizationMethod=i,this._variableChunkSize=n,this._isDynamicChunks=e}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(t){let s=this.minmaxMatrix.shape[0]-t.length,i=(0,$.default)(new Float32Array(2*s),[s,2]),n=0,e=s,o=0,r=this.minmaxMatrix.shape[0];for(let h=0;h<t.length;h++)r=t[h],e=r-o+n,e>n&&R.assign(i.hi(e,2).lo(n,0),this.minmaxMatrix.hi(r,2).lo(o,0)),n=e,o=r+1;return n<s&&R.assign(i.lo(n,0),this.minmaxMatrix.lo(o,0)),i}_createPrunedQuantized(t){let n,e,s=this.quantized.shape[0]-t.length,i=this._quantizationMethod;"norm8x"===i?(e=this._quantized.shape[1],n=(0,$.default)(new Uint8Array(e?s*e:s),e?[s,e]:[s,1])):n=(0,$.default)("norm565"===i?new Uint16Array(s):new Uint32Array(s),[s]);let o=0,r=s,h=0,u=n.shape[0];for(let f=0;f<t.length;f++)u=t[f],r=u-h+o,r>o&&(e?R.assign(n.hi(r,e).lo(o,0),this._quantized.hi(u,e).lo(h,0)):R.assign(n.hi(r).lo(o),this._quantized.hi(u).lo(h))),o=r,h=u+1;return o<s&&(e?R.assign(n.lo(o,0),this._quantized.lo(h,0)):R.assign(n.lo(o),this._quantized.lo(h))),n}pruneFeature(t,a,s){let i=this._createPrunedQuantized(t),n=this._createPrunedMinMax(a);return new L(i,n,this._chunkSize,this._quantizationMethod,s,!0)}static getRequiredNChunks(t,a){return Math.floor(t/a)}static fromArray(t,a,s){let o,i=t.shape[0],n=Math.floor(i/s),e=(0,$.default)(new Float32Array(2*n),[n,2],[2,1]);o="norm8x"===a?(0,$.default)(new Uint8Array(t.size),t.shape):(0,$.default)("norm565"===a?new Uint16Array(t.shape[0]):new Uint32Array(t.shape[0]),[t.shape[0]]);for(let r=0;r<n;r++){let f,h=r*s,u=r+1<n?(r+1)*s:i;f=it.createFromUnnormalized(t.shape.length>1?t.hi(u,t.shape[1]).lo(h,0):t.hi(u).lo(h)),e.set(r,0,f.minD),e.set(r,1,f.maxD),R.assign(o.shape.length>1?o.hi(u,o.shape[1]).lo(h,0):o.hi(u).lo(h),B.fromNormalized(f,a).quantized)}return new L(o,e,s,a)}denormDequant(){let e,o,t=this._minMaxMatrix.shape[0],a=this._quantized,s=a.shape[0],i=this._quantizationMethod,n=this._chunkSize;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");e=this._variableChunkSize}o="norm8x"===i?(0,$.default)(new Float32Array(a.size),a.shape):(0,$.default)(new Float32Array(3*s),[s,3]);let r=0,h=n;for(let u=0;u<t;u++){let[f,p]=[this._minMaxMatrix.get(u,0),this._minMaxMatrix.get(u,1)];this._isDynamicChunks&&(h=e[u]);let c,l=u+1<t?r+h:s;c=new B(a.shape.length>1?a.hi(l,a.shape[1]).lo(r,0):a.hi(l).lo(r),i),R.assign(o.hi(l,o.shape[1]).lo(r,0),c.dequantize(f,p).denormalize()),r=l}return o}static fetchArrayBuffer(t){return(0,st.Z)(function*(){return yield(yield fetch(t,{mode:"cors"})).arrayBuffer()})()}},H=T(J(),1),V=T(tt(),1),Q=T(J(),1),C=T(tt(),1),vt=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function Mt(t){return t<1e5?t<100?t<10?0:1:t<1e4?t<1e3?2:3:4:t<1e7?t<1e6?5:6:t<1e9?t<1e8?7:8:9}function xt(t,a){if(t===a)return 0;if(~~t===t&&~~a===a){if(0===t||0===a)return t<a?-1:1;if(t<0||a<0){if(a>=0)return-1;if(t>=0)return 1;t=-t,a=-a}let n=Mt(t),e=Mt(a),o=0;return n<e?(t*=vt[e-n-1],a/=10,o=-1):n>e&&(a*=vt[n-e-1],t/=10,o=1),t===a?o:t<a?-1:1}let s=String(t),i=String(a);return s===i?0:s<i?-1:1}function wt(t,a,s,i){let n=a+1;if(n===s)return 1;if(i(t[n++],t[a])<0){for(;n<s&&i(t[n],t[n-1])<0;)n++;!function la(t,a,s){for(s--;a<s;){let i=t[a];t[a++]=t[s],t[s--]=i}}(t,a,n)}else for(;n<s&&i(t[n],t[n-1])>=0;)n++;return n-a}function kt(t,a,s,i,n){for(i===a&&i++;i<s;i++){let e=t[i],o=a,r=i;for(;o<r;){let u=o+r>>>1;n(e,t[u])<0?r=u:o=u+1}let h=i-o;switch(h){case 3:t[o+3]=t[o+2];case 2:t[o+2]=t[o+1];case 1:t[o+1]=t[o];break;default:for(;h>0;)t[o+h]=t[o+h-1],h--}t[o]=e}}function ut(t,a,s,i,n,e){let o=0,r=0,h=1;if(e(t,a[s+n])>0){for(r=i-n;h<r&&e(t,a[s+n+h])>0;)o=h,h=1+(h<<1),h<=0&&(h=r);h>r&&(h=r),o+=n,h+=n}else{for(r=n+1;h<r&&e(t,a[s+n-h])<=0;)o=h,h=1+(h<<1),h<=0&&(h=r);h>r&&(h=r);let u=o;o=n-h,h=n-u}for(o++;o<h;){let u=o+(h-o>>>1);e(t,a[s+u])>0?o=u+1:h=u}return h}function lt(t,a,s,i,n,e){let o=0,r=0,h=1;if(e(t,a[s+n])<0){for(r=n+1;h<r&&e(t,a[s+n-h])<0;)o=h,h=1+(h<<1),h<=0&&(h=r);h>r&&(h=r);let u=o;o=n-h,h=n-u}else{for(r=i-n;h<r&&e(t,a[s+n+h])>=0;)o=h,h=1+(h<<1),h<=0&&(h=r);h>r&&(h=r),o+=n,h+=n}for(o++;o<h;){let u=o+(h-o>>>1);e(t,a[s+u])<0?h=u:o=u+1}return h}function ct(t){let a=(0,Q.default)(new Int32Array(t.shape[0]),[t.shape[0]]),s=(0,Q.default)(new Int32Array(t.shape[0]),[t.shape[0]]);return C.bands(a,t,1023),C.lshifts(s,a,16),C.bxoreq(a,s),C.bandseq(a,4278190335),C.lshifts(s,a,8),C.bxoreq(a,s),C.bandseq(a,50393103),C.lshifts(s,a,4),C.bxoreq(a,s),C.bandseq(a,51130563),C.lshifts(s,a,2),C.bxoreq(a,s),C.bandseq(a,153391689),a}function X(t,a){if(t.shape[0]!==a.shape[0])throw new Error("wrong length");let s=(0,Q.default)(new Float32Array(t.size),t.shape,t.stride,t.offset);for(let i=0;i<a.shape[0];i++){let n=a.get(i);if(t.shape.length>1)for(let e=0;e<t.shape[1];e++)s.set(i,e,t.get(n,e));else s.set(i,t.get(n))}return s}function da(t){let a=C.sup(t),s=C.inf(t),i=1e3/Math.min(1e3,a-s),n=(0,Q.default)(new Float32Array(t.data),t.shape);C.mulseq(n,i);let o=function pa(t){let a=ct(t.pick(null,0)),s=ct(t.pick(null,1));C.lshiftseq(s,1);let i=ct(t.pick(null,2));return C.lshiftseq(i,2),C.boreq(a,s),C.boreq(a,i),a}((0,Q.default)(new Int32Array(n.data),t.shape)),r=Array.from(o.data).map((u,f)=>[u,f]);!function fa(t,a,s,i){if(!Array.isArray(t))throw new TypeError("Can only sort arrays");a?"function"!=typeof a&&(i=s,s=a,a=xt):a=xt,s||(s=0),i||(i=t.length);let n=i-s;if(n<2)return;let e=0;if(n<32)return e=wt(t,s,i,a),void kt(t,s,i,s+e,a);let o=new class{constructor(t,a){P(this,"array",null),P(this,"compare",null),P(this,"minGallop",7),P(this,"length",0),P(this,"tmpStorageLength",256),P(this,"stackLength",0),P(this,"runStart",null),P(this,"runLength",null),P(this,"stackSize",0),this.array=t,this.compare=a,this.length=t.length,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(t,a){this.runStart[this.stackSize]=t,this.runLength[this.stackSize]=a,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;if(t>=1&&this.runLength[t-1]<=this.runLength[t]+this.runLength[t+1]||t>=2&&this.runLength[t-2]<=this.runLength[t]+this.runLength[t-1])this.runLength[t-1]<this.runLength[t+1]&&t--;else if(this.runLength[t]>this.runLength[t+1])break;this.mergeAt(t)}}forceMergeRuns(){for(;this.stackSize>1;){let t=this.stackSize-2;t>0&&this.runLength[t-1]<this.runLength[t+1]&&t--,this.mergeAt(t)}}mergeAt(t){let a=this.compare,s=this.array,i=this.runStart[t],n=this.runLength[t],e=this.runStart[t+1],o=this.runLength[t+1];this.runLength[t]=n+o,t===this.stackSize-3&&(this.runStart[t+1]=this.runStart[t+2],this.runLength[t+1]=this.runLength[t+2]),this.stackSize--;let r=lt(s[e],s,i,n,0,a);i+=r,n-=r,0!==n&&(o=ut(s[i+n-1],s,e,o,o-1,a),0!==o&&(n<=o?this.mergeLow(i,n,e,o):this.mergeHigh(i,n,e,o)))}mergeLow(t,a,s,i){let n=this.compare,e=this.array,o=this.tmp,r=0;for(r=0;r<a;r++)o[r]=e[t+r];let h=0,u=s,f=t;if(e[f++]=e[u++],0==--i){for(r=0;r<a;r++)e[f+r]=o[h+r];return}if(1===a){for(r=0;r<i;r++)e[f+r]=e[u+r];return void(e[f+i]=o[h])}let p=this.minGallop;for(;;){let l=0,c=0,d=!1;do{if(n(e[u],o[h])<0){if(e[f++]=e[u++],c++,l=0,0==--i){d=!0;break}}else if(e[f++]=o[h++],l++,c=0,1==--a){d=!0;break}}while((l|c)<p);if(d)break;do{if(l=lt(e[u],o,h,a,0,n),0!==l){for(r=0;r<l;r++)e[f+r]=o[h+r];if(f+=l,h+=l,(a-=l)<=1){d=!0;break}}if(e[f++]=e[u++],0==--i){d=!0;break}if(c=ut(o[h],e,u,i,0,n),0!==c){for(r=0;r<c;r++)e[f+r]=e[u+r];if(f+=c,u+=c,0==(i-=c)){d=!0;break}}if(e[f++]=o[h++],1==--a){d=!0;break}p--}while(l>=7||c>=7);if(d)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),1===a){for(r=0;r<i;r++)e[f+r]=e[u+r];e[f+i]=o[h]}else{if(0===a)throw new Error("mergeLow preconditions were not respected");for(r=0;r<a;r++)e[f+r]=o[h+r]}}mergeHigh(t,a,s,i){let n=this.compare,e=this.array,o=this.tmp,r=0;for(r=0;r<i;r++)o[r]=e[s+r];let h=t+a-1,u=i-1,f=s+i-1,p=0,l=0;if(e[f--]=e[h--],0==--a){for(p=f-(i-1),r=0;r<i;r++)e[p+r]=o[r];return}if(1===i){for(f-=a,h-=a,l=f+1,p=h+1,r=a-1;r>=0;r--)e[l+r]=e[p+r];return void(e[f]=o[u])}let c=this.minGallop;for(;;){let d=0,g=0,y=!1;do{if(n(o[u],e[h])<0){if(e[f--]=e[h--],d++,g=0,0==--a){y=!0;break}}else if(e[f--]=o[u--],g++,d=0,1==--i){y=!0;break}}while((d|g)<c);if(y)break;do{if(d=a-lt(o[u],e,t,a,a-1,n),0!==d){for(f-=d,h-=d,a-=d,l=f+1,p=h+1,r=d-1;r>=0;r--)e[l+r]=e[p+r];if(0===a){y=!0;break}}if(e[f--]=o[u--],1==--i){y=!0;break}if(g=i-ut(e[h],o,0,i,i-1,n),0!==g){for(f-=g,u-=g,i-=g,l=f+1,p=u+1,r=0;r<g;r++)e[l+r]=o[p+r];if(i<=1){y=!0;break}}if(e[f--]=e[h--],0==--a){y=!0;break}c--}while(d>=7||g>=7);if(y)break;c<0&&(c=0),c+=2}if(this.minGallop=c,c<1&&(this.minGallop=1),1===i){for(f-=a,h-=a,l=f+1,p=h+1,r=a-1;r>=0;r--)e[l+r]=e[p+r];e[f]=o[u]}else{if(0===i)throw new Error("mergeHigh preconditions were not respected");for(p=f-(i-1),r=0;r<i;r++)e[p+r]=o[r]}}}(t,a),r=function ua(t){let a=0;for(;t>=32;)a|=1&t,t>>=1;return t+a}(n);do{if(e=wt(t,s,i,a),e<r){let h=n;h>r&&(h=r),kt(t,s,s+h,s+e,a),e=h}o.pushRun(s,e),o.mergeRuns(),n-=e,s+=e}while(0!==n);o.forceMergeRuns()}(r,(u,f)=>u[0]-f[0]);let h=r.map(([u,f])=>f);return(0,Q.default)(Uint32Array.from(h))}var W=class{constructor(t,a,s,i,n,e,o,r,h,u){this.propertyDescs=t,this.format=a,this.nsplats=s,this.xyz=i,this.colors=n,this.harmonics=e,this.opacity=o,this.scaling=r,this.rotation=h,this.maxSHDegree=u}getPlyBinary(){let t=W._generateHeaderString(this.propertyDescs,this.format,this.nsplats),a=(new TextEncoder).encode(t),s=Object.keys(this.propertyDescs).length,i=(0,H.default)(new Float32Array(this.nsplats*s),[this.nsplats,s]);if(V.assign(i.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),V.assign(i.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),V.assign(i.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),V.assign(i.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),V.assign(i.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),V.assign(i.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),V.assign(i.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),V.assign(i.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),V.assign(i.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),V.assign(i.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),V.assign(i.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),V.assign(i.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),V.assign(i.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),V.assign(i.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let o=0;o<this.harmonics.length;o++){let r=3*o;V.assign(i.pick(null,this.propertyDescs[`f_rest_${r}`].index),this.harmonics[o].pick(null,0)),V.assign(i.pick(null,this.propertyDescs[`f_rest_${r+1}`].index),this.harmonics[o].pick(null,1)),V.assign(i.pick(null,this.propertyDescs[`f_rest_${r+2}`].index),this.harmonics[o].pick(null,2))}let n=new Uint8Array(i.data.buffer),e=new Uint8Array(n.length+a.length);return e.set(a),e.set(n,a.length),e.buffer}save(t,a){let s=this.getPlyBinary(),i=new Blob([s],{type:"application/octet-stream"}),n=new File([i],t),e=new FormData;e.append("file",n),e.append("filename",t),e.append("basedir",a),fetch("http://127.0.0.1:8000/push_file",{method:"POST",body:e})}static loadFile(t){return(0,st.Z)(function*(){return yield(yield fetch(t)).arrayBuffer()})()}mortonPositionSplatsSort(){let t=da(this.xyz),a=X(this.xyz,t),s=X(this.colors,t),i=X(this.opacity,t),n=X(this.scaling,t),e=X(this.rotation,t),o=[];for(let r=0;r<this.harmonics.length;r++)o.push(X(this.harmonics[r],t));return new W(this.propertyDescs,this.format,this.nsplats,a,s,o,i,n,e,this.maxSHDegree)}static _generateHeaderString(t,a,s){let i=`ply\nformat ${a.format} ${a.version}\nelement vertex ${s}`,n=Object.keys(t).length,e=Array(n);for(let o in t){let r=t[o];e[r.index]={name:o,dtype:r.dtype}}for(let o=0;o<e.length;o++)i=`${i}\nproperty ${e[o].dtype} ${e[o].name}`;return`${i}\nend_header\n`}static fromArrayBuffer(t,a=3){let{splatCount:s,vertexData:i,propertiesDesc:n,format:e}=W.decodeHeader(t),o=i.buffer.slice(i.byteOffset),r=Object.keys(n).length,h=(0,H.default)(new Float32Array(o),[s,r]),u=0,f={},p={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let b in n)if(n.hasOwnProperty(b)){let M=n[b].dtype;f[b]=u,u+=p[M]}let l=(0,H.default)(new Float32Array(3*s),[s,3]);V.assign(l.pick(null,0),h.pick(null,f.x/4)),V.assign(l.pick(null,1),h.pick(null,f.y/4)),V.assign(l.pick(null,2),h.pick(null,f.z/4));let c=(0,H.default)(new Float32Array(3*s),[s,3]);V.assign(c.pick(null,0),h.pick(null,f.scale_0/4)),V.assign(c.pick(null,1),h.pick(null,f.scale_1/4)),V.assign(c.pick(null,2),h.pick(null,f.scale_2/4));let d=(0,H.default)(new Float32Array(3*s),[s,3]);V.assign(d.pick(null,0),h.pick(null,f.f_dc_0/4)),V.assign(d.pick(null,1),h.pick(null,f.f_dc_1/4)),V.assign(d.pick(null,2),h.pick(null,f.f_dc_2/4));let g=(0,H.default)(new Float32Array(4*s),[s,4]);V.assign(g.pick(null,0),h.pick(null,f.rot_1/4)),V.assign(g.pick(null,1),h.pick(null,f.rot_2/4)),V.assign(g.pick(null,2),h.pick(null,f.rot_3/4)),V.assign(g.pick(null,3),h.pick(null,f.rot_0/4));for(let b=0;b<s;b++){let M=g.pick(b,null),x=Math.sqrt(M.get(0)**2+M.get(1)**2+M.get(2)**2+M.get(3)**2);V.divseq(M,x)}let y=(0,H.default)(new Float32Array(1*s),[s,1]);V.assign(y.pick(null,0),h.pick(null,f.opacity/4)),V.negeq(y),V.expeq(y),V.addseq(y,1),V.recipeq(y),V.mulseq(y,255);let m=(Math.min(Math.max(a,0),3)+1)**2-1,_=[];for(let b=0;b<m;b++){let M=(0,H.default)(new Float32Array(3*s),[s,3]),x=3*b;V.assign(M.pick(null,0),h.pick(null,f[`f_rest_${x}`]/4)),V.assign(M.pick(null,1),h.pick(null,f[`f_rest_${x+1}`]/4)),V.assign(M.pick(null,2),h.pick(null,f[`f_rest_${x+2}`]/4)),_.push(M)}return new W(n,e,s,l,d,_,y,c,g,a)}static fromPLYFile(t,a=3){return(0,st.Z)(function*(){let s=yield W.loadFile(t);return W.fromArrayBuffer(s,a)})()}static decodeHeader(t){let a=new TextDecoder,s=0,i="",n=100;for(;;){if(s+n>=t.byteLength)throw new Error("End of file reached while searching for end of header");let c=new Uint8Array(t,s,n);i+=a.decode(c),s+=n;let d=s-200,g=new Uint8Array(t,Math.max(0,d),d>0?200:n);if(a.decode(g).includes("end_header"))break}let f,e=i.split("\n"),o=0,r={},h={},u=0;for(let c=0;c<e.length;c++){let d=e[c].trim();if(d.startsWith("element vertex")){let g=d.match(/\d+/);g&&(o=parseInt(g[0]))}else if(d.startsWith("property")){let g=d.match(/(\w+)\s+(\w+)\s+(\w+)/);if(g){let y=g[2],m=g[3];r[m]=u,h[m]={dtype:y,index:u},u++}}else if(d.startsWith("format")){let g=d.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);g&&(f={format:g[2],version:g[3]})}else if("end_header"===d)break}let p=i.indexOf("end_header")+10+1;return{splatCount:o,vertexData:new DataView(t,p),headerOffset:s,propertiesDesc:h,format:f}}},et=class{constructor(t,a,s,i,n,e,o,r){this.config=t,this.xyz=a,this.scaling=s,this.color=i,this.opacity=n,this.harmonics=o,this.quaternion=e,this.variableChunkSize=r}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(t,a){let s=L.fromArray(t.xyz,a.xyz,a.chunkSize),i=L.fromArray(t.scaling,a.scaling,a.chunkSize),n=L.fromArray(t.colors,a.color,a.chunkSize),e=L.fromArray(t.opacity,a.opacity,a.chunkSize),o=L.fromArray(t.rotation,a.quaternion,a.chunkSize),r=t.harmonics,h=[];if(a.harmonics)for(let u=0;u<r.length;u++){let f=L.fromArray(r[u],a.harmonics,a.chunkSize);h.push(f)}return new et(a,s,i,n,e,o,h)}_countIndexesInChunks(t){let a=[],s=this.nchunks,i=this.chunkSize;if(s===L.getRequiredNChunks(this.nsplats,i))for(let o=0;o<t.length;o++){let r=t[o],h=Math.floor(r/this.chunkSize);h in a?a[h].push(r):a[h]=[r]}else{let o=this.variableChunkSize,r={},h=0;for(let u=0;u<s;u++)r[u]=h,h+=o[u];for(let u=0;u<t.length;u++){let f=t[u],p=Math.min(Math.floor(f/i),s-1);for(;f>=r[p]+o[p];)p++;p in a?a[p].push(f):a[p]=[f]}}return a}pruneSplats(t){let s,a=this._countIndexesInChunks(t),i=[];return a.length>0&&(s=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),a.forEach((n,e)=>{s[e]-=n.length,s[e]<=0&&i.push(e)}),s=s.filter(n=>n>0)),new et(this.config,this.xyz.pruneFeature(t,i,s),this.scaling.pruneFeature(t,i,s),this.color.pruneFeature(t,i,s),this.opacity.pruneFeature(t,i,s),this.quaternion.pruneFeature(t,i,s),this.harmonics?this.harmonics.map(n=>n.pruneFeature(t,i,this.variableChunkSize)):void 0,s)}static loadConfig(t){return(0,st.Z)(function*(){return yield(yield fetch(t,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()})()}toGaussians(){let a={},s=0;if(a.x={dtype:"float",index:s},s++,a.y={dtype:"float",index:s},s++,a.z={dtype:"float",index:s},s++,a.f_dc_0={dtype:"float",index:s},s++,a.f_dc_1={dtype:"float",index:s},s++,a.f_dc_2={dtype:"float",index:s},s++,this.harmonics&&this.harmonics.length>0)for(let n=0;n<this.harmonics.length;n++)a[`f_rest_${n}`]={dtype:"float",index:s},s++,a[`f_rest_${n+1}`]={dtype:"float",index:s},s++,a[`f_rest_${n+2}`]={dtype:"float",index:s},s++;a.opacity={dtype:"float",index:s},s++,a.scale_0={dtype:"float",index:s},s++,a.scale_1={dtype:"float",index:s},s++,a.scale_2={dtype:"float",index:s},s++,a.rot_0={dtype:"float",index:s},s++,a.rot_1={dtype:"float",index:s},s++,a.rot_2={dtype:"float",index:s},s++,a.rot_3={dtype:"float",index:s},s++;let i=this.harmonics?.map(n=>n.denormDequant());return new W(a,{format:"binary_little_endian",version:"1.0"},this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),i||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},K=T(J(),1),O=T(tt(),1),D=1e-6,E=typeof Float32Array<"u"?Float32Array:Array,ft=Math.random;Math,Math.hypot||(Math.hypot=function(){for(var t=0,a=arguments.length;a--;)t+=arguments[a]*arguments[a];return Math.sqrt(t)});var Z={};function At(){var t=new E(9);return E!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ya(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[4],t[4]=a[5],t[5]=a[6],t[6]=a[8],t[7]=a[9],t[8]=a[10],t}function ga(t){var a=new E(9);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a}function ma(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t}function ba(t,a,s,i,n,e,o,r,h){var u=new E(9);return u[0]=t,u[1]=a,u[2]=s,u[3]=i,u[4]=n,u[5]=e,u[6]=o,u[7]=r,u[8]=h,u}function _a(t,a,s,i,n,e,o,r,h,u){return t[0]=a,t[1]=s,t[2]=i,t[3]=n,t[4]=e,t[5]=o,t[6]=r,t[7]=h,t[8]=u,t}function va(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ma(t,a){if(t===a){var s=a[1],i=a[2],n=a[5];t[1]=a[3],t[2]=a[6],t[3]=s,t[5]=a[7],t[6]=i,t[7]=n}else t[0]=a[0],t[1]=a[3],t[2]=a[6],t[3]=a[1],t[4]=a[4],t[5]=a[7],t[6]=a[2],t[7]=a[5],t[8]=a[8];return t}function xa(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],p=f*o-r*u,l=-f*e+r*h,c=u*e-o*h,d=s*p+i*l+n*c;return d?(t[0]=p*(d=1/d),t[1]=(-f*i+n*u)*d,t[2]=(r*i-n*o)*d,t[3]=l*d,t[4]=(f*s-n*h)*d,t[5]=(-r*s+n*e)*d,t[6]=c*d,t[7]=(-u*s+i*h)*d,t[8]=(o*s-i*e)*d,t):null}function wa(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8];return t[0]=o*f-r*u,t[1]=n*u-i*f,t[2]=i*r-n*o,t[3]=r*h-e*f,t[4]=s*f-n*h,t[5]=n*e-s*r,t[6]=e*u-o*h,t[7]=i*h-s*u,t[8]=s*o-i*e,t}function ka(t){var n=t[3],e=t[4],o=t[5],r=t[6],h=t[7],u=t[8];return t[0]*(u*e-o*h)+t[1]*(-u*n+o*r)+t[2]*(h*n-e*r)}function qt(t,a,s){var i=a[0],n=a[1],e=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],p=a[8],l=s[0],c=s[1],d=s[2],g=s[3],y=s[4],m=s[5],_=s[6],b=s[7],M=s[8];return t[0]=l*i+c*o+d*u,t[1]=l*n+c*r+d*f,t[2]=l*e+c*h+d*p,t[3]=g*i+y*o+m*u,t[4]=g*n+y*r+m*f,t[5]=g*e+y*h+m*p,t[6]=_*i+b*o+M*u,t[7]=_*n+b*r+M*f,t[8]=_*e+b*h+M*p,t}function Aa(t,a,s){var i=a[0],n=a[1],e=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],p=a[8],l=s[0],c=s[1];return t[0]=i,t[1]=n,t[2]=e,t[3]=o,t[4]=r,t[5]=h,t[6]=l*i+c*o+u,t[7]=l*n+c*r+f,t[8]=l*e+c*h+p,t}function qa(t,a,s){var i=a[0],n=a[1],e=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],p=a[8],l=Math.sin(s),c=Math.cos(s);return t[0]=c*i+l*o,t[1]=c*n+l*r,t[2]=c*e+l*h,t[3]=c*o-l*i,t[4]=c*r-l*n,t[5]=c*h-l*e,t[6]=u,t[7]=f,t[8]=p,t}function za(t,a,s){var i=s[0],n=s[1];return t[0]=i*a[0],t[1]=i*a[1],t[2]=i*a[2],t[3]=n*a[3],t[4]=n*a[4],t[5]=n*a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t}function ja(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=a[0],t[7]=a[1],t[8]=1,t}function Va(t,a){var s=Math.sin(a),i=Math.cos(a);return t[0]=i,t[1]=s,t[2]=0,t[3]=-s,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Sa(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=a[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Da(t,a){return t[0]=a[0],t[1]=a[1],t[2]=0,t[3]=a[2],t[4]=a[3],t[5]=0,t[6]=a[4],t[7]=a[5],t[8]=1,t}function Fa(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=s+s,r=i+i,h=n+n,u=s*o,f=i*o,p=i*r,l=n*o,c=n*r,d=n*h,g=e*o,y=e*r,m=e*h;return t[0]=1-p-d,t[3]=f-m,t[6]=l+y,t[1]=f+m,t[4]=1-u-d,t[7]=c-g,t[2]=l-y,t[5]=c+g,t[8]=1-u-p,t}function Na(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],p=a[9],l=a[10],c=a[11],d=a[12],g=a[13],y=a[14],m=a[15],_=s*r-i*o,b=s*h-n*o,M=s*u-e*o,x=i*h-n*r,w=i*u-e*r,v=n*u-e*h,A=f*g-p*d,S=f*y-l*d,z=f*m-c*d,k=p*y-l*g,F=p*m-c*g,N=l*m-c*y,q=_*N-b*F+M*k+x*z-w*S+v*A;return q?(t[0]=(r*N-h*F+u*k)*(q=1/q),t[1]=(h*z-o*N-u*S)*q,t[2]=(o*F-r*z+u*A)*q,t[3]=(n*F-i*N-e*k)*q,t[4]=(s*N-n*z+e*S)*q,t[5]=(i*z-s*F-e*A)*q,t[6]=(g*v-y*w+m*x)*q,t[7]=(y*M-d*v-m*b)*q,t[8]=(d*w-g*M+m*_)*q,t):null}function Ba(t,a,s){return t[0]=2/a,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/s,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function La(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Ua(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ca(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t[3]=a[3]+s[3],t[4]=a[4]+s[4],t[5]=a[5]+s[5],t[6]=a[6]+s[6],t[7]=a[7]+s[7],t[8]=a[8]+s[8],t}function zt(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t[3]=a[3]-s[3],t[4]=a[4]-s[4],t[5]=a[5]-s[5],t[6]=a[6]-s[6],t[7]=a[7]-s[7],t[8]=a[8]-s[8],t}function Ea(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t[4]=a[4]*s,t[5]=a[5]*s,t[6]=a[6]*s,t[7]=a[7]*s,t[8]=a[8]*s,t}function Ia(t,a,s,i){return t[0]=a[0]+s[0]*i,t[1]=a[1]+s[1]*i,t[2]=a[2]+s[2]*i,t[3]=a[3]+s[3]*i,t[4]=a[4]+s[4]*i,t[5]=a[5]+s[5]*i,t[6]=a[6]+s[6]*i,t[7]=a[7]+s[7]*i,t[8]=a[8]+s[8]*i,t}function Oa(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]}function Ta(t,a){var s=t[0],i=t[1],n=t[2],e=t[3],o=t[4],r=t[5],h=t[6],u=t[7],f=t[8],p=a[0],l=a[1],c=a[2],d=a[3],g=a[4],y=a[5],m=a[6],_=a[7],b=a[8];return Math.abs(s-p)<=D*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(i-l)<=D*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=D*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(e-d)<=D*Math.max(1,Math.abs(e),Math.abs(d))&&Math.abs(o-g)<=D*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(r-y)<=D*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(h-m)<=D*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-_)<=D*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(f-b)<=D*Math.max(1,Math.abs(f),Math.abs(b))}ht(Z,{add:()=>Ca,adjoint:()=>wa,clone:()=>ga,copy:()=>ma,create:()=>At,determinant:()=>ka,equals:()=>Ta,exactEquals:()=>Oa,frob:()=>Ua,fromMat2d:()=>Da,fromMat4:()=>ya,fromQuat:()=>Fa,fromRotation:()=>Va,fromScaling:()=>Sa,fromTranslation:()=>ja,fromValues:()=>ba,identity:()=>va,invert:()=>xa,mul:()=>$a,multiply:()=>qt,multiplyScalar:()=>Ea,multiplyScalarAndAdd:()=>Ia,normalFromMat4:()=>Na,projection:()=>Ba,rotate:()=>qa,scale:()=>za,set:()=>_a,str:()=>La,sub:()=>Pa,subtract:()=>zt,translate:()=>Aa,transpose:()=>Ma});var $a=qt,Pa=zt,pt={};function Ra(){var t=new E(16);return E!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ga(t){var a=new E(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function Ha(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function Wa(t,a,s,i,n,e,o,r,h,u,f,p,l,c,d,g){var y=new E(16);return y[0]=t,y[1]=a,y[2]=s,y[3]=i,y[4]=n,y[5]=e,y[6]=o,y[7]=r,y[8]=h,y[9]=u,y[10]=f,y[11]=p,y[12]=l,y[13]=c,y[14]=d,y[15]=g,y}function Za(t,a,s,i,n,e,o,r,h,u,f,p,l,c,d,g,y){return t[0]=a,t[1]=s,t[2]=i,t[3]=n,t[4]=e,t[5]=o,t[6]=r,t[7]=h,t[8]=u,t[9]=f,t[10]=p,t[11]=l,t[12]=c,t[13]=d,t[14]=g,t[15]=y,t}function jt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ya(t,a){if(t===a){var s=a[1],i=a[2],n=a[3],e=a[6],o=a[7],r=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=s,t[6]=a[9],t[7]=a[13],t[8]=i,t[9]=e,t[11]=a[14],t[12]=n,t[13]=o,t[14]=r}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t}function Qa(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],p=a[9],l=a[10],c=a[11],d=a[12],g=a[13],y=a[14],m=a[15],_=s*r-i*o,b=s*h-n*o,M=s*u-e*o,x=i*h-n*r,w=i*u-e*r,v=n*u-e*h,A=f*g-p*d,S=f*y-l*d,z=f*m-c*d,k=p*y-l*g,F=p*m-c*g,N=l*m-c*y,q=_*N-b*F+M*k+x*z-w*S+v*A;return q?(t[0]=(r*N-h*F+u*k)*(q=1/q),t[1]=(n*F-i*N-e*k)*q,t[2]=(g*v-y*w+m*x)*q,t[3]=(l*w-p*v-c*x)*q,t[4]=(h*z-o*N-u*S)*q,t[5]=(s*N-n*z+e*S)*q,t[6]=(y*M-d*v-m*b)*q,t[7]=(f*v-l*M+c*b)*q,t[8]=(o*F-r*z+u*A)*q,t[9]=(i*z-s*F-e*A)*q,t[10]=(d*w-g*M+m*_)*q,t[11]=(p*M-f*w-c*_)*q,t[12]=(r*S-o*k-h*A)*q,t[13]=(s*k-i*S+n*A)*q,t[14]=(g*b-d*x-y*_)*q,t[15]=(f*x-p*b+l*_)*q,t):null}function Xa(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=a[4],r=a[5],h=a[6],u=a[7],f=a[8],p=a[9],l=a[10],c=a[11],d=a[12],g=a[13],y=a[14],m=a[15];return t[0]=r*(l*m-c*y)-p*(h*m-u*y)+g*(h*c-u*l),t[1]=-(i*(l*m-c*y)-p*(n*m-e*y)+g*(n*c-e*l)),t[2]=i*(h*m-u*y)-r*(n*m-e*y)+g*(n*u-e*h),t[3]=-(i*(h*c-u*l)-r*(n*c-e*l)+p*(n*u-e*h)),t[4]=-(o*(l*m-c*y)-f*(h*m-u*y)+d*(h*c-u*l)),t[5]=s*(l*m-c*y)-f*(n*m-e*y)+d*(n*c-e*l),t[6]=-(s*(h*m-u*y)-o*(n*m-e*y)+d*(n*u-e*h)),t[7]=s*(h*c-u*l)-o*(n*c-e*l)+f*(n*u-e*h),t[8]=o*(p*m-c*g)-f*(r*m-u*g)+d*(r*c-u*p),t[9]=-(s*(p*m-c*g)-f*(i*m-e*g)+d*(i*c-e*p)),t[10]=s*(r*m-u*g)-o*(i*m-e*g)+d*(i*u-e*r),t[11]=-(s*(r*c-u*p)-o*(i*c-e*p)+f*(i*u-e*r)),t[12]=-(o*(p*y-l*g)-f*(r*y-h*g)+d*(r*l-h*p)),t[13]=s*(p*y-l*g)-f*(i*y-n*g)+d*(i*l-n*p),t[14]=-(s*(r*y-h*g)-o*(i*y-n*g)+d*(i*h-n*r)),t[15]=s*(r*l-h*p)-o*(i*l-n*p)+f*(i*h-n*r),t}function Ka(t){var a=t[0],s=t[1],i=t[2],n=t[3],e=t[4],o=t[5],r=t[6],h=t[7],u=t[8],f=t[9],p=t[10],l=t[11],c=t[12],d=t[13],g=t[14],y=t[15];return(a*o-s*e)*(p*y-l*g)-(a*r-i*e)*(f*y-l*d)+(a*h-n*e)*(f*g-p*d)+(s*r-i*o)*(u*y-l*c)-(s*h-n*o)*(u*g-p*c)+(i*h-n*r)*(u*d-f*c)}function Vt(t,a,s){var i=a[0],n=a[1],e=a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],p=a[8],l=a[9],c=a[10],d=a[11],g=a[12],y=a[13],m=a[14],_=a[15],b=s[0],M=s[1],x=s[2],w=s[3];return t[0]=b*i+M*r+x*p+w*g,t[1]=b*n+M*h+x*l+w*y,t[2]=b*e+M*u+x*c+w*m,t[3]=b*o+M*f+x*d+w*_,t[4]=(b=s[4])*i+(M=s[5])*r+(x=s[6])*p+(w=s[7])*g,t[5]=b*n+M*h+x*l+w*y,t[6]=b*e+M*u+x*c+w*m,t[7]=b*o+M*f+x*d+w*_,t[8]=(b=s[8])*i+(M=s[9])*r+(x=s[10])*p+(w=s[11])*g,t[9]=b*n+M*h+x*l+w*y,t[10]=b*e+M*u+x*c+w*m,t[11]=b*o+M*f+x*d+w*_,t[12]=(b=s[12])*i+(M=s[13])*r+(x=s[14])*p+(w=s[15])*g,t[13]=b*n+M*h+x*l+w*y,t[14]=b*e+M*u+x*c+w*m,t[15]=b*o+M*f+x*d+w*_,t}function Ja(t,a,s){var o,r,h,u,f,p,l,c,d,g,y,m,i=s[0],n=s[1],e=s[2];return a===t?(t[12]=a[0]*i+a[4]*n+a[8]*e+a[12],t[13]=a[1]*i+a[5]*n+a[9]*e+a[13],t[14]=a[2]*i+a[6]*n+a[10]*e+a[14],t[15]=a[3]*i+a[7]*n+a[11]*e+a[15]):(r=a[1],h=a[2],u=a[3],f=a[4],p=a[5],l=a[6],c=a[7],d=a[8],g=a[9],y=a[10],m=a[11],t[0]=o=a[0],t[1]=r,t[2]=h,t[3]=u,t[4]=f,t[5]=p,t[6]=l,t[7]=c,t[8]=d,t[9]=g,t[10]=y,t[11]=m,t[12]=o*i+f*n+d*e+a[12],t[13]=r*i+p*n+g*e+a[13],t[14]=h*i+l*n+y*e+a[14],t[15]=u*i+c*n+m*e+a[15]),t}function ts(t,a,s){var i=s[0],n=s[1],e=s[2];return t[0]=a[0]*i,t[1]=a[1]*i,t[2]=a[2]*i,t[3]=a[3]*i,t[4]=a[4]*n,t[5]=a[5]*n,t[6]=a[6]*n,t[7]=a[7]*n,t[8]=a[8]*e,t[9]=a[9]*e,t[10]=a[10]*e,t[11]=a[11]*e,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t}function as(t,a,s,i){var h,u,f,p,l,c,d,g,y,m,_,b,M,x,w,v,A,S,z,k,F,N,q,I,n=i[0],e=i[1],o=i[2],r=Math.hypot(n,e,o);return r<D?null:(n*=r=1/r,e*=r,o*=r,h=Math.sin(s),u=Math.cos(s),l=a[1],c=a[2],d=a[3],y=a[5],m=a[6],_=a[7],M=a[9],x=a[10],w=a[11],z=n*e*(f=1-u)-o*h,k=e*e*f+u,F=o*e*f+n*h,N=n*o*f+e*h,q=e*o*f-n*h,I=o*o*f+u,t[0]=(p=a[0])*(v=n*n*f+u)+(g=a[4])*(A=e*n*f+o*h)+(b=a[8])*(S=o*n*f-e*h),t[1]=l*v+y*A+M*S,t[2]=c*v+m*A+x*S,t[3]=d*v+_*A+w*S,t[4]=p*z+g*k+b*F,t[5]=l*z+y*k+M*F,t[6]=c*z+m*k+x*F,t[7]=d*z+_*k+w*F,t[8]=p*N+g*q+b*I,t[9]=l*N+y*q+M*I,t[10]=c*N+m*q+x*I,t[11]=d*N+_*q+w*I,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)}function ss(t,a,s){var i=Math.sin(s),n=Math.cos(s),e=a[4],o=a[5],r=a[6],h=a[7],u=a[8],f=a[9],p=a[10],l=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=e*n+u*i,t[5]=o*n+f*i,t[6]=r*n+p*i,t[7]=h*n+l*i,t[8]=u*n-e*i,t[9]=f*n-o*i,t[10]=p*n-r*i,t[11]=l*n-h*i,t}function ns(t,a,s){var i=Math.sin(s),n=Math.cos(s),e=a[0],o=a[1],r=a[2],h=a[3],u=a[8],f=a[9],p=a[10],l=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=e*n-u*i,t[1]=o*n-f*i,t[2]=r*n-p*i,t[3]=h*n-l*i,t[8]=e*i+u*n,t[9]=o*i+f*n,t[10]=r*i+p*n,t[11]=h*i+l*n,t}function is(t,a,s){var i=Math.sin(s),n=Math.cos(s),e=a[0],o=a[1],r=a[2],h=a[3],u=a[4],f=a[5],p=a[6],l=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=e*n+u*i,t[1]=o*n+f*i,t[2]=r*n+p*i,t[3]=h*n+l*i,t[4]=u*n-e*i,t[5]=f*n-o*i,t[6]=p*n-r*i,t[7]=l*n-h*i,t}function es(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function os(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rs(t,a,s){var r,h,u,i=s[0],n=s[1],e=s[2],o=Math.hypot(i,n,e);return o<D?null:(i*=o=1/o,n*=o,e*=o,r=Math.sin(a),h=Math.cos(a),t[0]=i*i*(u=1-h)+h,t[1]=n*i*u+e*r,t[2]=e*i*u-n*r,t[3]=0,t[4]=i*n*u-e*r,t[5]=n*n*u+h,t[6]=e*n*u+i*r,t[7]=0,t[8]=i*e*u+n*r,t[9]=n*e*u-i*r,t[10]=e*e*u+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function hs(t,a){var s=Math.sin(a),i=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=s,t[7]=0,t[8]=0,t[9]=-s,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function us(t,a){var s=Math.sin(a),i=Math.cos(a);return t[0]=i,t[1]=0,t[2]=-s,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=s,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ls(t,a){var s=Math.sin(a),i=Math.cos(a);return t[0]=i,t[1]=s,t[2]=0,t[3]=0,t[4]=-s,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function St(t,a,s){var i=a[0],n=a[1],e=a[2],o=a[3],r=i+i,h=n+n,u=e+e,f=i*r,p=i*h,l=i*u,c=n*h,d=n*u,g=e*u,y=o*r,m=o*h,_=o*u;return t[0]=1-(c+g),t[1]=p+_,t[2]=l-m,t[3]=0,t[4]=p-_,t[5]=1-(f+g),t[6]=d+y,t[7]=0,t[8]=l+m,t[9]=d-y,t[10]=1-(f+c),t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t}function cs(t,a){var s=new E(3),i=-a[0],n=-a[1],e=-a[2],o=a[3],r=a[4],h=a[5],u=a[6],f=a[7],p=i*i+n*n+e*e+o*o;return p>0?(s[0]=2*(r*o+f*i+h*e-u*n)/p,s[1]=2*(h*o+f*n+u*i-r*e)/p,s[2]=2*(u*o+f*e+r*n-h*i)/p):(s[0]=2*(r*o+f*i+h*e-u*n),s[1]=2*(h*o+f*n+u*i-r*e),s[2]=2*(u*o+f*e+r*n-h*i)),St(t,a,s),t}function fs(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t}function Dt(t,a){var e=a[4],o=a[5],r=a[6],h=a[8],u=a[9],f=a[10];return t[0]=Math.hypot(a[0],a[1],a[2]),t[1]=Math.hypot(e,o,r),t[2]=Math.hypot(h,u,f),t}function ps(t,a){var s=new E(3);Dt(s,a);var i=1/s[0],n=1/s[1],e=1/s[2],o=a[0]*i,r=a[1]*n,h=a[2]*e,u=a[4]*i,f=a[5]*n,p=a[6]*e,l=a[8]*i,c=a[9]*n,d=a[10]*e,g=o+f+d,y=0;return g>0?(y=2*Math.sqrt(g+1),t[3]=.25*y,t[0]=(p-c)/y,t[1]=(l-h)/y,t[2]=(r-u)/y):o>f&&o>d?(y=2*Math.sqrt(1+o-f-d),t[3]=(p-c)/y,t[0]=.25*y,t[1]=(r+u)/y,t[2]=(l+h)/y):f>d?(y=2*Math.sqrt(1+f-o-d),t[3]=(l-h)/y,t[0]=(r+u)/y,t[1]=.25*y,t[2]=(p+c)/y):(y=2*Math.sqrt(1+d-o-f),t[3]=(r-u)/y,t[0]=(l+h)/y,t[1]=(p+c)/y,t[2]=.25*y),t}function ds(t,a,s,i){var n=a[0],e=a[1],o=a[2],r=a[3],h=n+n,u=e+e,f=o+o,p=n*h,l=n*u,c=n*f,d=e*u,g=e*f,y=o*f,m=r*h,_=r*u,b=r*f,M=i[0],x=i[1],w=i[2];return t[0]=(1-(d+y))*M,t[1]=(l+b)*M,t[2]=(c-_)*M,t[3]=0,t[4]=(l-b)*x,t[5]=(1-(p+y))*x,t[6]=(g+m)*x,t[7]=0,t[8]=(c+_)*w,t[9]=(g-m)*w,t[10]=(1-(p+d))*w,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t}function ys(t,a,s,i,n){var e=a[0],o=a[1],r=a[2],h=a[3],u=e+e,f=o+o,p=r+r,l=e*u,c=e*f,d=e*p,g=o*f,y=o*p,m=r*p,_=h*u,b=h*f,M=h*p,x=i[0],w=i[1],v=i[2],A=n[0],S=n[1],z=n[2],k=(1-(g+m))*x,F=(c+M)*x,N=(d-b)*x,q=(c-M)*w,I=(1-(l+m))*w,Y=(y+_)*w,at=(d+b)*v,Wt=(y-_)*v,Zt=(1-(l+g))*v;return t[0]=k,t[1]=F,t[2]=N,t[3]=0,t[4]=q,t[5]=I,t[6]=Y,t[7]=0,t[8]=at,t[9]=Wt,t[10]=Zt,t[11]=0,t[12]=s[0]+A-(k*A+q*S+at*z),t[13]=s[1]+S-(F*A+I*S+Wt*z),t[14]=s[2]+z-(N*A+Y*S+Zt*z),t[15]=1,t}function gs(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=s+s,r=i+i,h=n+n,u=s*o,f=i*o,p=i*r,l=n*o,c=n*r,d=n*h,g=e*o,y=e*r,m=e*h;return t[0]=1-p-d,t[1]=f+m,t[2]=l-y,t[3]=0,t[4]=f-m,t[5]=1-u-d,t[6]=c+g,t[7]=0,t[8]=l+y,t[9]=c-g,t[10]=1-u-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ms(t,a,s,i,n,e,o){var r=1/(s-a),h=1/(n-i),u=1/(e-o);return t[0]=2*e*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*e*h,t[6]=0,t[7]=0,t[8]=(s+a)*r,t[9]=(n+i)*h,t[10]=(o+e)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e*2*u,t[15]=0,t}function Ft(t,a,s,i,n){var o,e=1/Math.tan(a/2);return t[0]=e/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+i)*(o=1/(i-n)),t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}ht(pt,{add:()=>zs,adjoint:()=>Xa,clone:()=>Ga,copy:()=>Ha,create:()=>Ra,determinant:()=>Ka,equals:()=>Ds,exactEquals:()=>Ss,frob:()=>qs,fromQuat:()=>gs,fromQuat2:()=>cs,fromRotation:()=>rs,fromRotationTranslation:()=>St,fromRotationTranslationScale:()=>ds,fromRotationTranslationScaleOrigin:()=>ys,fromScaling:()=>os,fromTranslation:()=>es,fromValues:()=>Wa,fromXRotation:()=>hs,fromYRotation:()=>us,fromZRotation:()=>ls,frustum:()=>ms,getRotation:()=>ps,getScaling:()=>Dt,getTranslation:()=>fs,identity:()=>jt,invert:()=>Qa,lookAt:()=>ws,mul:()=>Fs,multiply:()=>Vt,multiplyScalar:()=>js,multiplyScalarAndAdd:()=>Vs,ortho:()=>Ms,orthoNO:()=>Nt,orthoZO:()=>xs,perspective:()=>bs,perspectiveFromFieldOfView:()=>vs,perspectiveNO:()=>Ft,perspectiveZO:()=>_s,rotate:()=>as,rotateX:()=>ss,rotateY:()=>ns,rotateZ:()=>is,scale:()=>ts,set:()=>Za,str:()=>As,sub:()=>Ns,subtract:()=>Bt,targetTo:()=>ks,translate:()=>Ja,transpose:()=>Ya});var bs=Ft;function _s(t,a,s,i,n){var o,e=1/Math.tan(a/2);return t[0]=e/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=n*(o=1/(i-n)),t[14]=n*i*o):(t[10]=-1,t[14]=-i),t}function vs(t,a,s,i){var n=Math.tan(a.upDegrees*Math.PI/180),e=Math.tan(a.downDegrees*Math.PI/180),o=Math.tan(a.leftDegrees*Math.PI/180),r=Math.tan(a.rightDegrees*Math.PI/180),h=2/(o+r),u=2/(n+e);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(o-r)*h*.5,t[9]=(n-e)*u*.5,t[10]=i/(s-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*s/(s-i),t[15]=0,t}function Nt(t,a,s,i,n,e,o){var r=1/(a-s),h=1/(i-n),u=1/(e-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(a+s)*r,t[13]=(n+i)*h,t[14]=(o+e)*u,t[15]=1,t}var Ms=Nt;function xs(t,a,s,i,n,e,o){var r=1/(a-s),h=1/(i-n),u=1/(e-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(a+s)*r,t[13]=(n+i)*h,t[14]=e*u,t[15]=1,t}function ws(t,a,s,i){var n,e,o,r,h,u,f,p,l,c,d=a[0],g=a[1],y=a[2],m=i[0],_=i[1],b=i[2],M=s[0],x=s[1],w=s[2];return Math.abs(d-M)<D&&Math.abs(g-x)<D&&Math.abs(y-w)<D?jt(t):(f=d-M,p=g-x,l=y-w,n=_*(l*=c=1/Math.hypot(f,p,l))-b*(p*=c),e=b*(f*=c)-m*l,o=m*p-_*f,(c=Math.hypot(n,e,o))?(n*=c=1/c,e*=c,o*=c):(n=0,e=0,o=0),r=p*o-l*e,h=l*n-f*o,u=f*e-p*n,(c=Math.hypot(r,h,u))?(r*=c=1/c,h*=c,u*=c):(r=0,h=0,u=0),t[0]=n,t[1]=r,t[2]=f,t[3]=0,t[4]=e,t[5]=h,t[6]=p,t[7]=0,t[8]=o,t[9]=u,t[10]=l,t[11]=0,t[12]=-(n*d+e*g+o*y),t[13]=-(r*d+h*g+u*y),t[14]=-(f*d+p*g+l*y),t[15]=1,t)}function ks(t,a,s,i){var n=a[0],e=a[1],o=a[2],r=i[0],h=i[1],u=i[2],f=n-s[0],p=e-s[1],l=o-s[2],c=f*f+p*p+l*l;c>0&&(f*=c=1/Math.sqrt(c),p*=c,l*=c);var d=h*l-u*p,g=u*f-r*l,y=r*p-h*f;return(c=d*d+g*g+y*y)>0&&(d*=c=1/Math.sqrt(c),g*=c,y*=c),t[0]=d,t[1]=g,t[2]=y,t[3]=0,t[4]=p*y-l*g,t[5]=l*d-f*y,t[6]=f*g-p*d,t[7]=0,t[8]=f,t[9]=p,t[10]=l,t[11]=0,t[12]=n,t[13]=e,t[14]=o,t[15]=1,t}function As(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function qs(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function zs(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t[3]=a[3]+s[3],t[4]=a[4]+s[4],t[5]=a[5]+s[5],t[6]=a[6]+s[6],t[7]=a[7]+s[7],t[8]=a[8]+s[8],t[9]=a[9]+s[9],t[10]=a[10]+s[10],t[11]=a[11]+s[11],t[12]=a[12]+s[12],t[13]=a[13]+s[13],t[14]=a[14]+s[14],t[15]=a[15]+s[15],t}function Bt(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t[3]=a[3]-s[3],t[4]=a[4]-s[4],t[5]=a[5]-s[5],t[6]=a[6]-s[6],t[7]=a[7]-s[7],t[8]=a[8]-s[8],t[9]=a[9]-s[9],t[10]=a[10]-s[10],t[11]=a[11]-s[11],t[12]=a[12]-s[12],t[13]=a[13]-s[13],t[14]=a[14]-s[14],t[15]=a[15]-s[15],t}function js(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t[4]=a[4]*s,t[5]=a[5]*s,t[6]=a[6]*s,t[7]=a[7]*s,t[8]=a[8]*s,t[9]=a[9]*s,t[10]=a[10]*s,t[11]=a[11]*s,t[12]=a[12]*s,t[13]=a[13]*s,t[14]=a[14]*s,t[15]=a[15]*s,t}function Vs(t,a,s,i){return t[0]=a[0]+s[0]*i,t[1]=a[1]+s[1]*i,t[2]=a[2]+s[2]*i,t[3]=a[3]+s[3]*i,t[4]=a[4]+s[4]*i,t[5]=a[5]+s[5]*i,t[6]=a[6]+s[6]*i,t[7]=a[7]+s[7]*i,t[8]=a[8]+s[8]*i,t[9]=a[9]+s[9]*i,t[10]=a[10]+s[10]*i,t[11]=a[11]+s[11]*i,t[12]=a[12]+s[12]*i,t[13]=a[13]+s[13]*i,t[14]=a[14]+s[14]*i,t[15]=a[15]+s[15]*i,t}function Ss(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]}function Ds(t,a){var s=t[0],i=t[1],n=t[2],e=t[3],o=t[4],r=t[5],h=t[6],u=t[7],f=t[8],p=t[9],l=t[10],c=t[11],d=t[12],g=t[13],y=t[14],m=t[15],_=a[0],b=a[1],M=a[2],x=a[3],w=a[4],v=a[5],A=a[6],S=a[7],z=a[8],k=a[9],F=a[10],N=a[11],q=a[12],I=a[13],Y=a[14],at=a[15];return Math.abs(s-_)<=D*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(i-b)<=D*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-M)<=D*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(e-x)<=D*Math.max(1,Math.abs(e),Math.abs(x))&&Math.abs(o-w)<=D*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(r-v)<=D*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(h-A)<=D*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(u-S)<=D*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(f-z)<=D*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(p-k)<=D*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(l-F)<=D*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(c-N)<=D*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(d-q)<=D*Math.max(1,Math.abs(d),Math.abs(q))&&Math.abs(g-I)<=D*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(y-Y)<=D*Math.max(1,Math.abs(y),Math.abs(Y))&&Math.abs(m-at)<=D*Math.max(1,Math.abs(m),Math.abs(at))}var Fs=Vt,Ns=Bt,dt={};function Lt(){var t=new E(3);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ut(t,a,s){var i=new E(3);return i[0]=t,i[1]=a,i[2]=s,i}function yt(t,a,s){var i=a[0],n=a[1],e=a[2],o=s[0],r=s[1],h=s[2];return t[0]=n*h-e*r,t[1]=e*o-i*h,t[2]=i*r-n*o,t}ht(dt,{add:()=>gn,calculateW:()=>en,clone:()=>fn,conjugate:()=>un,copy:()=>dn,create:()=>gt,dot:()=>Pt,equals:()=>xn,exactEquals:()=>Mn,exp:()=>It,fromEuler:()=>ln,fromMat3:()=>Tt,fromValues:()=>pn,getAngle:()=>tn,getAxisAngle:()=>Js,identity:()=>Ks,invert:()=>hn,len:()=>_n,length:()=>Rt,lerp:()=>bn,ln:()=>Ot,mul:()=>mn,multiply:()=>Et,normalize:()=>mt,pow:()=>on,random:()=>rn,rotateX:()=>an,rotateY:()=>sn,rotateZ:()=>nn,rotationTo:()=>wn,scale:()=>$t,set:()=>yn,setAxes:()=>An,setAxisAngle:()=>Ct,slerp:()=>ot,sqlerp:()=>kn,sqrLen:()=>vn,squaredLength:()=>Gt,str:()=>cn});function gt(){var t=new E(4);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ks(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ct(t,a,s){s*=.5;var i=Math.sin(s);return t[0]=i*a[0],t[1]=i*a[1],t[2]=i*a[2],t[3]=Math.cos(s),t}function Js(t,a){var s=2*Math.acos(a[3]),i=Math.sin(s/2);return i>D?(t[0]=a[0]/i,t[1]=a[1]/i,t[2]=a[2]/i):(t[0]=1,t[1]=0,t[2]=0),s}function tn(t,a){var s=Pt(t,a);return Math.acos(2*s*s-1)}function Et(t,a,s){var i=a[0],n=a[1],e=a[2],o=a[3],r=s[0],h=s[1],u=s[2],f=s[3];return t[0]=i*f+o*r+n*u-e*h,t[1]=n*f+o*h+e*r-i*u,t[2]=e*f+o*u+i*h-n*r,t[3]=o*f-i*r-n*h-e*u,t}function an(t,a,s){s*=.5;var i=a[0],n=a[1],e=a[2],o=a[3],r=Math.sin(s),h=Math.cos(s);return t[0]=i*h+o*r,t[1]=n*h+e*r,t[2]=e*h-n*r,t[3]=o*h-i*r,t}function sn(t,a,s){s*=.5;var i=a[0],n=a[1],e=a[2],o=a[3],r=Math.sin(s),h=Math.cos(s);return t[0]=i*h-e*r,t[1]=n*h+o*r,t[2]=e*h+i*r,t[3]=o*h-n*r,t}function nn(t,a,s){s*=.5;var i=a[0],n=a[1],e=a[2],o=a[3],r=Math.sin(s),h=Math.cos(s);return t[0]=i*h+n*r,t[1]=n*h-i*r,t[2]=e*h+o*r,t[3]=o*h-e*r,t}function en(t,a){var s=a[0],i=a[1],n=a[2];return t[0]=s,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-s*s-i*i-n*n)),t}function It(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=Math.sqrt(s*s+i*i+n*n),r=Math.exp(e),h=o>0?r*Math.sin(o)/o:0;return t[0]=s*h,t[1]=i*h,t[2]=n*h,t[3]=r*Math.cos(o),t}function Ot(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=Math.sqrt(s*s+i*i+n*n),r=o>0?Math.atan2(o,e)/o:0;return t[0]=s*r,t[1]=i*r,t[2]=n*r,t[3]=.5*Math.log(s*s+i*i+n*n+e*e),t}function on(t,a,s){return Ot(t,a),$t(t,t,s),It(t,t),t}function ot(t,a,s,i){var l,c,d,g,y,n=a[0],e=a[1],o=a[2],r=a[3],h=s[0],u=s[1],f=s[2],p=s[3];return(c=n*h+e*u+o*f+r*p)<0&&(c=-c,h=-h,u=-u,f=-f,p=-p),1-c>D?(l=Math.acos(c),d=Math.sin(l),g=Math.sin((1-i)*l)/d,y=Math.sin(i*l)/d):(g=1-i,y=i),t[0]=g*n+y*h,t[1]=g*e+y*u,t[2]=g*o+y*f,t[3]=g*r+y*p,t}function rn(t){var a=ft(),s=ft(),i=ft(),n=Math.sqrt(1-a),e=Math.sqrt(a);return t[0]=n*Math.sin(2*Math.PI*s),t[1]=n*Math.cos(2*Math.PI*s),t[2]=e*Math.sin(2*Math.PI*i),t[3]=e*Math.cos(2*Math.PI*i),t}function hn(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=s*s+i*i+n*n+e*e,r=o?1/o:0;return t[0]=-s*r,t[1]=-i*r,t[2]=-n*r,t[3]=e*r,t}function un(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=a[3],t}function Tt(t,a){var i,s=a[0]+a[4]+a[8];if(s>0)i=Math.sqrt(s+1),t[3]=.5*i,t[0]=(a[5]-a[7])*(i=.5/i),t[1]=(a[6]-a[2])*i,t[2]=(a[1]-a[3])*i;else{var n=0;a[4]>a[0]&&(n=1),a[8]>a[3*n+n]&&(n=2);var e=(n+1)%3,o=(n+2)%3;i=Math.sqrt(a[3*n+n]-a[3*e+e]-a[3*o+o]+1),t[n]=.5*i,t[3]=(a[3*e+o]-a[3*o+e])*(i=.5/i),t[e]=(a[3*e+n]+a[3*n+e])*i,t[o]=(a[3*o+n]+a[3*n+o])*i}return t}function ln(t,a,s,i){var n=.5*Math.PI/180;a*=n,s*=n,i*=n;var e=Math.sin(a),o=Math.cos(a),r=Math.sin(s),h=Math.cos(s),u=Math.sin(i),f=Math.cos(i);return t[0]=e*h*f-o*r*u,t[1]=o*r*f+e*h*u,t[2]=o*h*u-e*r*f,t[3]=o*h*f+e*r*u,t}function cn(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}Lt(),function Es(){var t=new E(4);E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var fn=function Is(t){var a=new E(4);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a},pn=function Os(t,a,s,i){var n=new E(4);return n[0]=t,n[1]=a,n[2]=s,n[3]=i,n},dn=function Ts(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t},yn=function $s(t,a,s,i,n){return t[0]=a,t[1]=s,t[2]=i,t[3]=n,t},gn=function Ps(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t[3]=a[3]+s[3],t},mn=Et,$t=function Rs(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},Pt=function Zs(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},bn=function Ys(t,a,s,i){var n=a[0],e=a[1],o=a[2],r=a[3];return t[0]=n+i*(s[0]-n),t[1]=e+i*(s[1]-e),t[2]=o+i*(s[2]-o),t[3]=r+i*(s[3]-r),t},Rt=function Gs(t){return Math.hypot(t[0],t[1],t[2],t[3])},_n=Rt,Gt=function Hs(t){var a=t[0],s=t[1],i=t[2],n=t[3];return a*a+s*s+i*i+n*n},vn=Gt,mt=function Ws(t,a){var s=a[0],i=a[1],n=a[2],e=a[3],o=s*s+i*i+n*n+e*e;return o>0&&(o=1/Math.sqrt(o)),t[0]=s*o,t[1]=i*o,t[2]=n*o,t[3]=e*o,t},Mn=function Qs(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]},xn=function Xs(t,a){var s=t[0],i=t[1],n=t[2],e=t[3],o=a[0],r=a[1],h=a[2],u=a[3];return Math.abs(s-o)<=D*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(i-r)<=D*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-h)<=D*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(e-u)<=D*Math.max(1,Math.abs(e),Math.abs(u))},wn=function(){var t=Lt(),a=Ut(1,0,0),s=Ut(0,1,0);return function(i,n,e){var o=function Us(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]}(n,e);return o<-.999999?(yt(t,a,n),function Bs(t){return Math.hypot(t[0],t[1],t[2])}(t)<1e-6&&yt(t,s,n),function Ls(t,a){var s=a[0],i=a[1],n=a[2],e=s*s+i*i+n*n;e>0&&(e=1/Math.sqrt(e)),t[0]=a[0]*e,t[1]=a[1]*e,t[2]=a[2]*e}(t,t),Ct(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(yt(t,n,e),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,mt(i,i))}}(),kn=function(){var t=gt(),a=gt();return function(s,i,n,e,o,r){return ot(t,i,o,r),ot(a,n,e,r),ot(s,t,a,2*r*(1-r)),s}}(),An=function(){var t=At();return function(a,s,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-s[0],t[5]=-s[1],t[8]=-s[2],mt(a,Tt(a,t))}}(),Ht={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},bt=class{constructor(t){this.version="",this._buffer=t}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let a=this.decoded.color.denormDequant(),s=this.decoded.opacity.denormDequant(),i=(0,K.default)(new Float32Array(4*a.shape[0]),[a.shape[0],4]);return O.mulseq(a,.28209479177387814),O.addseq(a,.5),O.mulseq(a,255),O.maxseq(a,0),O.minseq(a,255),""===this.version&&(O.negeq(s),O.expeq(s),O.addseq(s,1),O.recipeq(s),O.mulseq(s,255)),O.assign(i.hi(a.shape[0],3).lo(0,0),a),O.assign(i.hi(a.shape[0],4).lo(0,3),s),(0,K.default)(new Uint8Array(i.data),[a.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:t,chunkCount:a,chunkSize:s,typeChunks:i,vertexData:n,propertiesDesc:e,version:o}=this.decodeHeader();this.version=o;let r={xyz:e.xyz.compressionMethod,color:e.color.compressionMethod,opacity:e.opacity.compressionMethod,scaling:e.scaling.compressionMethod,quaternion:e.quaternion.compressionMethod,chunkSize:s};e.harmonics_0&&(r.harmonics=e.harmonics_0.compressionMethod);let h=n.byteOffset,u=Array(Object.keys(e).length);for(let m in e)u[e[m].index]={name:m,method:e[m].compressionMethod};let c,f=2*a*4,p=h,l="dynamic"===i?2*a:0,d=!1;if(l>0){let m=new Uint16Array(n.buffer.slice(p,p+l));p+=l,c=Array.from(m),d=!0}let g={};for(let m of u){let M,_=0,b=!0;if("norm8x"===m.method)_=1*t*Ht[m.name];else if("norm11"===m.method)_=4*t;else{if("norm565"!==m.method)throw b=!1,new Error(`Not Implemented format: ${m.method}`);_=2*t}if(!b)throw new Error("loading chunk byt hasnot minmax!");{let v=n.buffer.slice(p,p+f);M=(0,K.default)(new Float32Array(v),[a,2]),p+=f}let w,x=n.buffer.slice(p,p+_);if(p+=_,"norm8x"===m.method)w=(0,K.default)(new Uint8Array(x),[t,Ht[m.name]]);else if("norm11"===m.method)w=(0,K.default)(new Uint32Array(x));else{if("norm565"!==m.method)throw new Error(`Not Implemented format: ${m.method}`);w=(0,K.default)(new Uint16Array(x))}g[m.name]=new L(w,M,s,m.method,c,d)}let y=[];for(let m=0;m<15;m++){let _=g[`harmonics_${m}`];_&&(y.push(_),delete g[`harmonics_${m}`])}return y.length>0&&(g.harmonics=y),new et(r,g.xyz,g.scaling,g.color,g.opacity,g.quaternion,g.harmonics,c)}buildPreComputedBuffers(){let t=this.decoded,a=t.nsplats,s=new ArrayBuffer(24*a),i=new Float32Array(s),n=t.scaling.denormDequant(),e=t.quaternion.denormDequant(),o=dt.create(),r=Z.create(),h=Z.create(),u=Z.create(),f=pt.create();for(let p=0;p<a;p++){pt.fromScaling(f,[Math.exp(n.get(p,0)),Math.exp(n.get(p,1)),Math.exp(n.get(p,2))]),Z.fromMat4(h,f),dt.set(o,e.get(p,0),e.get(p,1),e.get(p,2),e.get(p,3)),Z.fromQuat(r,o),Z.multiply(u,r,h);let l=u;i[6*p]=l[0]*l[0]+l[3]*l[3]+l[6]*l[6],i[6*p+1]=l[0]*l[1]+l[3]*l[4]+l[6]*l[7],i[6*p+2]=l[0]*l[2]+l[3]*l[5]+l[6]*l[8],i[6*p+3]=l[1]*l[1]+l[4]*l[4]+l[7]*l[7],i[6*p+4]=l[1]*l[2]+l[4]*l[5]+l[7]*l[8],i[6*p+5]=l[2]*l[2]+l[5]*l[5]+l[8]*l[8]}this._precomputedCovarianceBufferData=s}decodeHeader(){let t=this._buffer,a=new TextDecoder,s=0,i="",n=100;for(;;){if(s+n>=t.byteLength)throw new Error("End of file reached while searching for end of header");let g=new Uint8Array(t,s,n);i+=a.decode(g),s+=n;let y=s-200,m=new Uint8Array(t,Math.max(0,y),y>=0?200:n);if(a.decode(m).includes("end_header"))break}let e=i.split("\n"),o=0,r=0,h=0,u=0,f="",p="",l={};for(let g=0;g<e.length;g++){let y=e[g].trim();if(y.startsWith("version"))p=y.split(" ")[1]??"";else if(y.startsWith("element vertex")){let m=y.match(/\d+/);m&&(o=parseInt(m[0]))}else if(y.startsWith("property")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);m&&(l[m[2]]={compressionMethod:m[3],index:u},u++)}else if(y.startsWith("element chunks")){let m=y.match(/\d+/);m&&(r=parseInt(m[0]))}else if(y.startsWith("element chunkSize")){let m=y.match(/\d+/);m&&(h=parseInt(m[0]))}else if(y.startsWith("element typeChunks")){let m=y.match(/(\w+)\s+(\w+)\s+(\w+)/);m&&(f=m[3])}else if("end_header"===y)break}let c=i.indexOf("end_header")+10+1;return{splatCount:o,chunkCount:r,chunkSize:h,typeChunks:f,vertexData:new DataView(t,c),propertiesDesc:l,version:p}}pruneSplats(t){let a=this.decodeBuffer().pruneSplats(t);return bt.fromCompressedGaussianSplats(a,this.version)}static fromCompressedGaussianSplats(t,a){let i=t.xyz.nchunks,n=`gspline\nversion ${a}\nelement vertex ${t.xyz.length}\nelement chunks ${i}\nelement chunkSize ${t.chunkSize}\nelement typeChunks ${t.isDynamicChunks?"dynamic":"static"}\nproperty xyz ${t.xyz.method}\nproperty color ${t.color.method}\nproperty opacity ${t.opacity.method}\nproperty scaling ${t.scaling.method}\nproperty quaternion ${t.quaternion.method}`;if(t.harmonics&&t.harmonics.length>0)for(let A=0;A<t.harmonics.length;A++)n=`${n}\nproperty harmonics_${A} ${t.harmonics[A].method}`;n=`${n}\nend_header\n`;let e=(new TextEncoder).encode(n),o=2*i*4,r=t.xyz.quantized.data.buffer.byteLength,h=t.xyz instanceof L?o:0,u=t.color.quantized.data.buffer.byteLength,f=t.color instanceof L?o:0,p=t.opacity.quantized.data.buffer.byteLength,l=t.opacity instanceof L?o:0,c=t.scaling.quantized.data.buffer.byteLength,d=t.scaling instanceof L?o:0,g=t.quaternion.quantized.data.buffer.byteLength,y=t.quaternion instanceof L?o:0,m=t.variableChunkSize?Uint16Array.from(t.variableChunkSize):void 0,_=m?m.byteLength:0,b=e.byteLength+_+r+h+u+f+p+l+c+d+g+y,M=0,x=0;if(t.harmonics&&t.harmonics.length>0)for(let A=0;A<t.harmonics.length;A++)M+=t.harmonics[A].quantized.data.buffer.byteLength,x+=t.harmonics[A]instanceof L?o:0;M=0,x=0,b+=M+x;let w=new Uint8Array(b),v=0;if(w.set(e,v),v+=e.byteLength,_>0&&(w.set(new Uint8Array(m.buffer),v),v+=_),t.xyz instanceof L&&(w.set(new Uint8Array(t.xyz.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.xyz.quantized.data.buffer),v),v+=r,t.color instanceof L&&(w.set(new Uint8Array(t.color.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.color.quantized.data.buffer),v),v+=u,t.opacity instanceof L&&(w.set(new Uint8Array(t.opacity.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.opacity.quantized.data.buffer),v),v+=p,t.scaling instanceof L&&(w.set(new Uint8Array(t.scaling.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.scaling.quantized.data.buffer),v),v+=c,t.quaternion instanceof L&&(w.set(new Uint8Array(t.quaternion.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(t.quaternion.quantized.data.buffer),v),v+=g,M>0&&t.harmonics&&t.harmonics.length>0)for(let A=0;A<t.harmonics.length;A++){let S=t.harmonics[A];S instanceof L&&(w.set(new Uint8Array(S.minmaxMatrix.data.buffer),v),v+=o),w.set(new Uint8Array(S.quantized.data.buffer),v),v+=S.quantized.data.byteLength}return new bt(w.buffer)}}}}]);